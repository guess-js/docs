{"data":{"markdownRemark":{"html":"<p>Guess.js for non-Webpack sites.</p>\n<p><em>Automatic, dynamic, intelligent prefetching for faster page loads.</em></p>\n<p>:heavy<em>check</em>mark: <strong>Automatic:</strong> Once you've setup predictive fetching you'll automatically be using it on all your pages. (No more forgetting to take advantage of prefetch.)</p>\n<p>:heavy<em>check</em>mark: <strong>Dynamic:</strong> As your site changes, prefetch links will adjust accordingly. (No more hardcoded prefetch URLs.)</p>\n<p>:heavy<em>check</em>mark: <strong>Intelligent:</strong> Predictive fetching uses the client's connection type to determine whether a resource should be prefetched.</p>\n<p>:point<em>right: &#x3C;a href=\"<a href=\"https://guess-static-sites-demo.firebaseapp.com/\">https://guess-static-sites-demo.firebaseapp.com/</a>\" target=\"</em>blank\">View Demo</a></p>\n<h2>How guess-static-sites works</h2>\n<p>This directory uses Google Analytics data to determine which page a user is mostly likely to visit next from a given page (<strong><em>generatePredictions.js</em></strong>).</p>\n<p>A client-side script (which you'll add to your application) sends a request to the server you are running to get the URL of the page it should fetch, it then prefetches this resource (<strong><em>script.js &#x26; server.js</em></strong>).</p>\n<p>If a user is on a poor connection, prefetching will only occur if there's a high level of certainty that a user will go to a particular page next. If a client is using the Save-Data header, no prefetching will occur.</p>\n<h2>Setup</h2>\n<p>After downloading the Guess.js repo, cd to this directory and install the dependencies:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ cd experiments/guess-static-sites\n$ npm install</code></pre></div>\n<h2>A) Server setup</h2>\n<p>Use this command to run the server:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ node server.js</code></pre></div>\n<h2>B) Script setup</h2>\n<ol>\n<li>Add predictiveFetching.js to your pages.</li>\n<li>In predictiveFetching.js, replace <code class=\"language-text\">&#39;http://YOUR_SERVER_ENDPOINT/&#39;</code> with the server endpoint you'll be using.</li>\n</ol>\n<h2>C) Database setup</h2>\n<p><strong>Prerequisites:</strong></p>\n<ul>\n<li>A Google Analytics account</li>\n<li>Mongo installed on your computer/server <a href=\"https://docs.mongodb.com/manual/installation/\">(Instructions)</a></li>\n</ul>\n<p>This is the final, and lengthiest, part of the setup process - but it should only take about 5-10 minutes to complete if you already have Mongo and a Google Analytics account. Afterwards you'll be ready to consume and analyze your Google Analytics data.</p>\n<h3>Create Your Credentials</h3>\n<h4>i) Create a Service Account</h4>\n<ol>\n<li>\n<p>Go to the <a href=\"https://console.developers.google.com/apis/credentials\">Credentials</a> page in the Google APIs console.</p>\n</li>\n<li>\n<p>If you don't have an existing Google Cloud project, click \"Create\" to create a new project. Otherwise, use the dropdown in the upper left corner to select the existing project that you'd like to use.</p>\n</li>\n<li>\n<p>Select \"Service Account key\" from the \"Create credentials\" dropdown.</p>\n</li>\n<li>\n<p>Fill out the form for creating a service account key:</p>\n</li>\n<li>\n<p><strong>Service account dropdown:</strong> Select \"New Service Account\".</p>\n</li>\n<li>\n<p><strong>Service account name:</strong> Give your service account a name.</p>\n</li>\n<li>\n<p><strong>Role:</strong> Select \"Service Account User\" (\"Service Accounts\" > \"Service Account User\").</p>\n</li>\n<li>\n<p><strong>Service account ID:</strong> This field will automatically be pre-filled, but you can change this if you would like.</p>\n</li>\n<li>\n<p><strong>Key type:</strong> Select P12 key.</p>\n</li>\n<li>\n<p>Click Create.</p>\n</li>\n</ol>\n<h4>ii) Setup Your Private Key</h4>\n<p>Your private key should have started downloading when you clicked the \"Create\" button for creating your service account.</p>\n<ol>\n<li>Note the private key password. You'll be prompted for this password in Step 3.</li>\n<li>Move this key into the directory for this project.</li>\n<li>\n<p>Generate a *.p12 certificate by running this command from the directory for this project:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ openssl pkcs12 -in *.p12 -out key.pem -nodes -clcerts</code></pre></div>\n</li>\n</ol>\n<h3>Configure Google Analytics</h3>\n<h4>i) Add service account to Google Analytics</h4>\n<p>The service account that you just created needs to be added as a user to your Google analytics account.</p>\n<ol>\n<li>Login to your <a href=\"https://analytics.google.com/analytics/web/\">Google Analytics</a> account.</li>\n<li>Add a new user. (Admin > User Management > + > Add New Users)</li>\n<li><strong>Email Address</strong> The email address of the service account you created. It should look something like this: example@example-project-123456.iam.gserviceaccount.com.</li>\n<li><strong>Permissions:</strong> Select \"Read &#x26; Analyze.\"</li>\n</ol>\n<p><em>Note: A service account can only be associated with one Google Analytics account at a time. Thus, if you want to use predictive fetching on multiple sites, you'll need to create a separate service account for each.</em></p>\n<h4>ii) Enable the Google Analytics Reporting API</h4>\n<p>You can enable this <a href=\"https://console.developers.google.com/flows/enableapi?apiid=analyticsreporting.googleapis.com&#x26;credential=client_key\">here.</a></p>\n<h3>Create your .env file</h3>\n<p>This file will hold your confidential configuration details.</p>\n<h4>i) Create the file</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ touch .env</code></pre></div>\n<h4>ii) Add your information</h4>\n<p>Your file should look like this (replace with your own values):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">VIEW_ID<span class=\"token operator\">=</span>12345678\nSERVICE_ACCOUNT_EMAIL<span class=\"token operator\">=</span>example@example-project-123456.iam.gserviceaccount.com</code></pre></div>\n<p>To find your view ID, go to <a href=\"https://analytics.google.com/analytics/web/\">Google Analytics</a>.\nClick the accounts dropdown (it's located in the upper lefthand corner  of the screen, right next to the Google Analytics logo). The dialog that opens will have three columns: Analytics Accounts, Properties &#x26; Apps, &#x26; Views. The far right column (\"Views\") will contain the View ID for your site.</p>\n<h3>Generate predictions</h3>\n<h4>i) Start mongod</h4>\n<p>If mongod is not running, start it:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ mongod</code></pre></div>\n<h4>ii) Run script</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ node generatePredictions.js</code></pre></div>\n<p>If this is successful, you should see something like this in the console for each page:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{ pagePath: &#39;dogs/poodle.html&#39;,\n  pageviews: 300,\n  exits: 200,\n  nextPageviews: 100,\n  nextExits: 100,\n  nextPages:\n   [ { pagePath: &#39;/dogs/puppies/&#39;, pageviews: 100 } ],\n  percentExits: 0.6666666666666666,\n  topNextPageProbability: 0.3333333333333333 }</code></pre></div>\n<p>You can also explore the results in Mongo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ mongo\n$ use guessjs_dev\n$ db.predictions.find()</code></pre></div>\n<h4>iii) (Optional) Setup a cron job</h4>\n<p>It is recommended that you set up a cron job to periodically re-run generatePredictions.js. This will ensure that the prefetch links are as accurate as possible. The ideal frequency of this cron job depends on how frequently your site changes.</p>\n<p>You can also experiment with the date range of data that is used to generate predictions. By default, GuessJS uses the last 30 days of traffic to generate predictions, but this value can be changed (this is located in file: <em>src/queryParams.js</em>). It's important to have a sufficiently large data set, so the ideal date range will largely depend on a site's traffic volume. A very high-traffic site might find that using the last 1-7 days of traffic works best, while a low-traffic site find that using the last 30 days works best.</p>","frontmatter":{"path":"/docs/static","title":"Using Guess.js with Static Sites"}}},"pageContext":{}}