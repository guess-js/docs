{"data":{"markdownRemark":{"html":"<p>In this guide, we'll introduce <strong>predictive prefething</strong> in an Angular application. Let us get started!</p>\n<div style=\"background-color: #e7f4ff; border-radius: 5px; padding: 20px; margin-bottom: 20px;\">\nYou can find the source code for the application on <a href=\"https://github.com/mgechev/guess-angular\">GitHub</a>.\n</div>\n<h3>Bootstrapping the Application</h3>\n<p>To bootstrap the application we're going to use Angular CLI. Make sure you have the latest version installed:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i -g @angular/cli\nng --version\n<span class=\"token comment\"># 7.0.3</span></code></pre></div>\n<p>After that run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ng new guess-angular</code></pre></div>\n<p>Make sure that during initialization you add Angular routing:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ng new guess-angular\n? Would you like to add Angular routing? Yes\n? Which stylesheet <span class=\"token function\">format</span> would you like to use? CSS</code></pre></div>\n<h3>Creating the Application</h3>\n<p>As next step, let us define a few routes! Inside the <code class=\"language-text\">app-routing.module.ts</code> add the following configuration:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NgModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Routes<span class=\"token punctuation\">,</span> RouterModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/router'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> routes<span class=\"token punctuation\">:</span> Routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n    pathMatch<span class=\"token punctuation\">:</span> <span class=\"token string\">'full'</span><span class=\"token punctuation\">,</span>\n    loadChildren<span class=\"token punctuation\">:</span> <span class=\"token string\">'./index/index.module#IndexModule'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token string\">'about'</span><span class=\"token punctuation\">,</span>\n    loadChildren<span class=\"token punctuation\">:</span> <span class=\"token string\">'./about/about.module#AboutModule'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token string\">'example'</span><span class=\"token punctuation\">,</span>\n    loadChildren<span class=\"token punctuation\">:</span> <span class=\"token string\">'./example/example.module#ExampleModule'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token string\">'media'</span><span class=\"token punctuation\">,</span>\n    loadChildren<span class=\"token punctuation\">:</span> <span class=\"token string\">'./media/media.module#MediaModule'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>RouterModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span>routes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  exports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>RouterModule<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppRoutingModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>We declare four routes, all of which we load lazily. For each individual route, declare the corresponding module and component. For example, for the <code class=\"language-text\">media</code> route, we should have <code class=\"language-text\">media.module.ts</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NgModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> RouterModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/router'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MediaComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./media.component'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  declarations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>MediaComponent<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  imports<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    RouterModule<span class=\"token punctuation\">.</span><span class=\"token function\">forChild</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        path<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n        component<span class=\"token punctuation\">:</span> MediaComponent\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MediaModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>And <code class=\"language-text\">media.component.ts</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n@<span class=\"token function\">Component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token punctuation\">:</span> <span class=\"token string\">'app-media'</span><span class=\"token punctuation\">,</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token string\">'Media'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MediaComponent</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>In the end, your <code class=\"language-text\">src/app</code> directory structure should look like follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── about\n│   ├── about.component.ts\n│   └── about.module.ts\n├── app-routing.module.ts\n├── app.component.css\n├── app.component.html\n├── app.component.spec.ts\n├── app.component.ts\n├── app.module.ts\n├── example\n│   ├── example.component.ts\n│   └── example.module.ts\n├── index\n│   ├── index.component.ts\n│   └── index.module.ts\n└── media\n    ├── media.component.ts\n    └── media.module.ts</code></pre></div>\n<p>In order to have a link to the <code class=\"language-text\">MediaModule</code>, set the template of the <code class=\"language-text\">AboutComponent</code> to:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">About <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">routerLink</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/media<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Media<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Finally, update the <code class=\"language-text\">AppComponent</code>'s template to:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">routerLink</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Home<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">routerLink</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>example<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Example<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">routerLink</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>about<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>About<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>router-outlet</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>router-outlet</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3>Running the Application</h3>\n<p>Once you've defined all routes from above, start a development server:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ng serve</code></pre></div>\n<img src=\"/website/images/angular-before.gif\" alt=\"Angular application\" style=\"display: block; max-width: 450px; margin: auto; margin-bottom: 20px;\">\n<p>Now notice that while navigating inside of the application, each time when you go to another page the browser sends a request for the corresponding page. This is due the fact that we're using lazy-loading for each individual route. Lazy-loading is a very powerful technique, which allows us to drop the size of the initial bundle. On the other hand, however, lazy-loading may also introduce latency when changing the page, if we haven't downloaded the bundles associated with the route we're navigating to.</p>\n<h3>Predictive Prefetching</h3>\n<p>In the example above the introduced latency is negotiable because the bundles are very small but in real-life application, the user would have to wait a hundreds of milliseconds. To address this issue <strong>we can use prefetching</strong>. Prefetching allows us to fetch in advance resources which are likely to be needed in near future. For example, if we know that after being in the \"Home\" page the user is likely to visit \"Example\" we can download the JavaScript associated with \"Example\" while the user is still in the \"Home\" page.</p>\n<p>Guess.js allows us to use prefetching by considering the user's navigational patterns extracted from analytics report. Guess.js can consume our data from Google Analytics, build a machine learning model, and at runtime prefetch the resources which are likely to be needed next!</p>\n<p>For simplicity in this guide, we're going to extract report from a file, instead of using Google Analytics. In the root of your application, create a file called <code class=\"language-text\">routes.json</code> and set the following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"/\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"/example\"</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"/about\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"/example\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"/\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"/media\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"/about\"</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"/about\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"/\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"/media\"</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"/media\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"/\"</span><span class=\"token operator\">:</span> <span class=\"token number\">33</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"/about\"</span><span class=\"token operator\">:</span> <span class=\"token number\">33</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"/example\"</span><span class=\"token operator\">:</span> <span class=\"token number\">34</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This file specifies how many times the user has visited given page from another. For example, if we look at the first property of the outer-most object, we can see that from <code class=\"language-text\">/</code>, there were <code class=\"language-text\">80</code> sessions in which users have visited <code class=\"language-text\">/example</code> and <code class=\"language-text\">20</code> sessions in which users have visited <code class=\"language-text\">/about</code>.</p>\n<p>Now lets update and so that we can use the Guess.js' webpack plugin!</p>\n<h3>Extending Angular CLI</h3>\n<p>To extend Angular CLI we're going to use <code class=\"language-text\">@angular-builders/custom-webpack</code> as explained in <a href=\"https://codeburst.io/customizing-angular-cli-6-build-an-alternative-to-ng-eject-a48304cd3b21\">this</a> tutorial.</p>\n<p>First, install <code class=\"language-text\">@angular-builders/custom-webpack</code> and <code class=\"language-text\">@angular-devkit/build-angular</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i -D @angular-builders/custom-webpack @angular-devkit/build-angular</code></pre></div>\n<p>As next step, open <code class=\"language-text\">angular.json</code> and update the <code class=\"language-text\">builder</code> value from <code class=\"language-text\">@angular-devkit/build-angular:browser</code> to <code class=\"language-text\">@angular-builders/custom-webpack:browser</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"architect\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  ...\n  <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"builder\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"@angular-builders/custom-webpack:browser\"</span>\n      <span class=\"token property\">\"options\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        ...\n      <span class=\"token punctuation\">}</span>\n    ...\n  <span class=\"token punctuation\">}</span>\n  ...\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As the next step, add an additional property to the <code class=\"language-text\">options</code> object:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"architect\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  ...\n  <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"builder\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"@angular-builders/custom-webpack:browser\"</span>\n      <span class=\"token property\">\"options\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"customWebpackConfig\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./extra-webpack.config.js\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n  ...\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"path":"/docs/angular","title":"Using Guess.js with Angular"}}},"pageContext":{}}